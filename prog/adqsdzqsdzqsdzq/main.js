// baseline is up left

let colors = [
  0,0,0,       // black : 0
  127,127,127, // dark gray : 1
  136,0,21,    // dark red : 2
  237,28,36,   // red : 3
  255,127,39,  // orange : 4
  255,242,0,   // yellow : 5
  34,177,76,   // green : 6
  0,162,232,   // aqua : 7
  63,72,204,   // blue : 8
  163,73,164,  // purple : 9
  255,255,255, // white : 10
  195,195,195, // gray : 11
  185,122,87,  // brown : 12
  255,174,201, // pink : 13
  255,201,14,  // gold : 14
  239,228,176, // beige : 15
  181,230,29,  // light green : 16
  153,217,234, // light blue : 17
  112,146,190, // dull blue : 18
  200,191,231, // lavender : 19
];

let transparencies = [
  0, 100, 200, 255
];

let newColors = [];

let littleNumbers = [
  [-1, 0, -1,
  0, -1, 0,
  0, -1, 0,
  0, -1, 0,
  -1, 0, -1], // 0
  [-1, 0, -1,
  0, 0, -1,
  -1, 0, -1,
  -1, 0, -1,
  -1, 0, -1], // 1
  [0, 0, -1,
  -1, -1, 0,
  -1, 0, -1,
  0, -1, -1,
  0, 0, 0], // 2
  [0, 0, -1,
  -1, -1, 0,
  -1, 0, -1,
  -1, -1, 0,
  0, 0, -1], // 3
  [0, -1, 0,
  0, -1, 0,
  0, 0, 0,
  -1, -1, 0,
  -1, -1, 0], // 4
  [0, 0, 0,
  0, -1, -1,
  0, 0, -1,
  -1, -1, 0,
  0, 0, -1], // 5
  [-1, 0, -1,
  0, -1, -1,
  0, 0, -1,
  0, -1, 0,
  -1, 0, -1], // 6
  [0, 0, 0,
  -1, -1, 0,
  -1, 0, -1,
  -1, 0, -1,
  -1, 0, -1], // 7
  [-1, 0, -1,
  0, -1, 0,
  -1, 0, -1,
  0, -1, 0,
  -1, 0, -1], // 8
  [-1, 0, -1,
  0, -1, 0,
  -1, 0, 0,
  -1, -1, 0,
  -1, 0, -1], // 9
];

let bigNumbers = [
  [0, 0, 0,
  0, -1, 0,
  0, -1, 0,
  0, -1, 0,
  0, 0, 0], // 0
  [-1, 0, -1,
  0, 0, -1,
  -1, 0, -1,
  -1, 0, -1,
  0, 0, 0], // 1
  [0, 0, 0,
  -1, -1, 0,
  0, 0, 0,
  0, -1, -1,
  0, 0, 0], // 2
  [0, 0, 0,
  -1, -1, 0,
  0, 0, 0,
  -1, -1, 0,
  0, 0, 0], // 3
  [0, -1, 0,
  0, -1, 0,
  0, 0, 0,
  -1, -1, 0,
  -1, -1, 0], // 4
  [0, 0, 0,
  0, -1, -1,
  0, 0, 0,
  -1, -1, 0,
  0, 0, 0], // 5
  [0, 0, 0,
  0, -1, -1,
  0, 0, 0,
  0, -1, 0,
  0, 0, 0], // 6
  [0, 0, 0,
  -1, -1, 0,
  -1, -1, 0,
  -1, -1, 0,
  -1, -1, 0], // 7
  [0, 0, 0,
  0, -1, 0,
  0, 0, 0,
  0, -1, 0,
  0, 0, 0], // 8
  [0, 0, 0,
  0, -1, 0,
  0, 0, 0,
  -1, -1, 0,
  0, 0, 0], // 9
];

let toolIcons = {
  "pencil" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 13, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 13, 13, 13, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  1, 13, 13, 13, 13,
    -1, -1, -1, -1, -1, -1, -1, -1, -1,  1, 11,  1, 13, 13, -1,
    -1, -1, -1, -1, -1, -1, -1, -1,  1,  5,  1, 11,  1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1,  1,  5, 14, 14,  1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  1,  5, 14, 14,  1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  1,  5, 14, 14,  1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1,  1,  5, 14, 14,  1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1,  1,  5, 14, 14,  1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  1,  5, 14, 14,  1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1,  1,  5, 14, 14,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    15, 15,  1, 14,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     0, 15, 15,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     0,  0, 15, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "bucket" : [
    -1,  3,  3,  3,  3,  3,  1,  1,  1,  1,  1,  1,  1, -1, -1,
     3,  3,  3,  3, 11, 11, 11, 10, 10, 11, 11,  1,  0,  0, -1,
     3,  3,  3,  1, 11, 11, 11, 10, 10, 11, 11,  1,  1, -1,  0,
     3,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1,  0,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, -1, -1,
  ],
  "bucketPlus" : [
    -1,  8,  8,  8,  8,  8,  1,  1,  1,  1,  1,  1,  1, -1, -1,
     8,  8,  8,  8, 11, 11, 11, 10, 10, 11, 11,  1,  0,  0, -1,
     8,  8,  8,  1, 11, 11, 11, 10, 10, 11, 11,  1,  1, -1,  0,
     8,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1,  0,  0,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1, 11, 11, 11, 10, 10, 11, 11, 11,  1, -1, -1,
    -1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, -1, -1,
  ],
  "rubber" : [
    -1, -1, -1, -1, -1, -1, -1,  8,  8, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  8,  7,  7,  8,  8, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  8,  7,  7,  7,  7,  7,  8,  8, -1, -1,
    -1, -1, -1, -1,  3, 13,  7,  7,  7,  7,  7,  7,  7,  8,  8,
    -1, -1, -1,  3, 13, 13, 13, 13,  7,  7,  7,  7,  7,  8,  8,
    -1, -1,  3, 13, 13, 13, 13, 13, 13, 13,  7,  7,  8,  7,  8,
    -1,  3, 13, 13, 13, 13, 13, 13, 13, 13, 13,  3,  7,  7,  8,
     3,  3, 13, 13, 13, 13, 13, 13, 13, 13,  3, 13,  7,  7,  8,
     3, 13,  3,  3, 13, 13, 13, 13, 13,  3, 13, 13,  7,  8, -1,
     3, 13, 13, 13,  3,  3, 13, 13,  3, 13, 13, 13,  8, -1, -1,
     3, 13, 13, 13, 13, 13,  3,  3, 13, 13, 13,  3, -1, -1, -1,
     3,  3, 13, 13, 13, 13, 13,  3, 13, 13,  3, -1, -1, -1, -1,
    -1, -1,  3,  3, 13, 13, 13,  3, 13,  3, -1, -1, -1, -1, -1,
    -1, -1, -1, -1,  3,  3, 13,  3,  3, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  3,  3, -1, -1, -1, -1, -1, -1, -1,
  ],
  "colorPicker" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,  7,  7,  8,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,  7,  7,  7,  8,
    -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,  7,  7,  7,  8,  8,
    -1, -1, -1, -1, -1, -1, -1,  8,  7,  7,  7,  7,  8,  8,  8,
    -1, -1, -1, -1, -1, -1, -1, -1,  8,  7,  7,  8,  8,  8, -1,
    -1, -1, -1, -1, -1, -1, -1,  1, 10,  8,  8,  8,  8, -1, -1,
    -1, -1, -1, -1, -1, -1,  1, 10, 10, 11,  8,  8, -1, -1, -1,
    -1, -1, -1, -1, -1,  1, 10, 10, 11,  1, -1,  8, -1, -1, -1,
    -1, -1, -1, -1,  1, 10, 10, 11,  1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1,  1, 10, 10, 11,  1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  1, 10, 10, 11,  1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  1, 10, 11,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1,  1, 10,  1,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     1, 10,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     1,  1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "brush0" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1,  0, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "brush1" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1,  0, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  0,  0,  0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1,  0, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "brush2" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  0,  0,  0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  0,  0,  0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "brush3" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  0,  0,  0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1,
    -1, -1, -1, -1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
    -1, -1, -1, -1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
    -1, -1, -1, -1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  0,  0,  0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "brush4" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  0,  0,  0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
    -1, -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
    -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1,
    -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1,
    -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,
    -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,
    -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,
    -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1,
    -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1,
    -1, -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
    -1, -1, -1, -1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  0,  0,  0, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "brush5" : [
    -1, -1, -1, -1, -1,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1,
    -1, -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
    -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1,
    -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,
    -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,
     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,
    -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,
    -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1,
    -1, -1, -1,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
    -1, -1, -1, -1, -1,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1,
  ],
  "selectRect" : [
    8,  8, -1,  8, -1,  8, -1,  8, -1,  8, -1,  8, -1,  8,  8,
    8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  8,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  8,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  8,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  8,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  8,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  8,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  8,
    8,  8, -1,  8, -1,  8, -1,  8, -1,  8, -1,  8, -1,  8,  8,
  ],
  "line" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,  7, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1,  7,  7, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  7,  7, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1,  7,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "curve" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,  7, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,  7, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1,  7,  7,  7, -1, -1, -1, -1, -1, -1,
    -1, -1, -1,  7,  7,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1,  7,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1,  7,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "ellipse" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  7,  7,  7,  7,  7, -1, -1, -1, -1, -1,
    -1, -1, -1,  7,  7, -1, -1, -1, -1, -1,  7,  7, -1, -1, -1,
    -1, -1,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1,
    -1,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
    -1,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1,
    -1, -1,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1,
    -1, -1, -1,  7,  7, -1, -1, -1, -1, -1,  7,  7, -1, -1, -1,
    -1, -1, -1, -1, -1,  7,  7,  7,  7,  7, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "rectangle" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7,
     7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "polygon" : [
    -1, -1, -1, -1, -1, -1, -1, -1,  7,  7, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1,  7,  7,  7, -1,  7, -1, -1, -1, -1, -1,
    -1, -1,  7,  7,  7, -1, -1, -1, -1,  7, -1, -1, -1, -1, -1,
     7,  7, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1,  7,  7,  7,  7,  7,  7,  7,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1,
     7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1,
     7,  7,  7, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1, -1, -1,
    -1, -1, -1,  7,  7,  7,  7, -1, -1,  7, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1,  7,  7, -1, -1, -1, -1, -1, -1,
  ],
  "text" : [
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
     7,  7,  7,  7,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  7, -1, -1, -1, -1, -1, -1, -1, -1, -1,  7, -1, -1,
    -1, -1,  7, -1, -1,  7, -1, -1, -1, -1, -1, -1,  7,  7, -1,
    -1, -1,  7, -1,  7, -1,  7, -1,  7, -1,  7, -1,  7, -1, -1,
    -1, -1,  7, -1,  7,  7, -1, -1, -1,  7, -1, -1,  7, -1, -1,
    -1, -1,  7, -1, -1,  7,  7, -1,  7, -1,  7, -1,  7,  7, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
  ],
  "gradient0" : [
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
 ],
 "gradient1" : [
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0, -1,  0,
 ],
 "gradient2" : [
    0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0,
 ],
 "gradient3" : [
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1, -1, -1,  0, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
 ],
 "gradient4" : [
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1,  0, -1, -1, -1, -1, -1, -1, -1,  0, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1,  0, -1, -1, -1, -1, -1, -1, -1,  0, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1,  0, -1, -1, -1, -1, -1, -1, -1,  0, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
   -1, -1, -1, -1, -1,  0, -1, -1, -1, -1, -1, -1, -1,  0, -1,
   -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
 ],
};

let patterns = {
  "brush0" : [
    1
  ],
  "brush1" : [
    0, 1, 0,
    1, 1, 1,
    0, 1, 0,
  ],
  "brush2" : [
    0, 1, 1, 1, 0,
    1, 1, 1, 1, 1,
    1, 1, 1, 1, 1,
    1, 1, 1, 1, 1,
    0, 1, 1, 1, 0,
  ],
  "brush3" : [
    0, 0, 1, 1, 1, 0, 0,
    0, 1, 1, 1, 1, 1, 0,
    1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1,
    0, 1, 1, 1, 1, 1, 0,
    0, 0, 1, 1, 1, 0, 0,
  ],
  "brush4" : [
    0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0,
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,
  ],
  "brush5" : [
    0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0,
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,
  ],
};

let windowIcons = {
  "title" : [
     8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8, 10, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10, 10, 10, 10,  8,  8, 10, 10,  8,  8, 10, 10, 10,  8,  8,  8, 10, 10,  8,
     8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,  8,  8,  8,  8, 10,  8,  8, 10,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,
     8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10, 10, 10, 10,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8, 10, 10, 10, 10, 10,  8, 10,  8,  8,  8,  8, 10,  8,  8, 10,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,
    10,  8,  8,  8, 10,  8, 10, 10, 10,  8,  8,  8, 10,  8,  8,  8, 10, 10, 10,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10, 10, 10, 10,  8,  8,  8, 10, 10, 10,  8,  8, 10, 10,  8,  8, 10,  8, 10, 10,  8,  8,  8, 10,  8, 10,  8,  8, 10,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,
    10,  8,  8,  8, 10,  8,  8,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8,  8, 10,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8, 10,  8, 10,  8,  8,  8, 10,  8,  8, 10,  8,  8, 10, 10,  8,  8, 10,  8,  8, 10,  8, 10,  8,  8, 10, 10, 10,  8,  8, 10, 10, 10,  8,  8,  8, 10, 10,  8,  8,  8, 10, 10,  8,
    10,  8,  8,  8, 10,  8,  8, 10, 10, 10,  8,  8, 10,  8,  8, 10, 10, 10, 10,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8, 10,  8, 10,  8,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,
     8, 10,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8, 10,  8, 10,  8,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8,  8,  8,  8, 10, 10, 10, 10, 10,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,
     8, 10,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8,  8,  8,  8, 10,  8,  8,  8,  8,  8,  8,  8,  8, 10,  8,  8,  8, 10,  8, 10,  8,  8,  8, 10,  8,  8, 10,  8,  8, 10,  8,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10,
     8,  8, 10,  8,  8,  8, 10, 10, 10, 10,  8, 10, 10, 10,  8,  8, 10, 10, 10, 10,  8,  8, 10, 10, 10,  8,  8,  8,  8,  8, 10,  8,  8,  8, 10,  8,  8, 10, 10, 10,  8,  8, 10, 10, 10,  8, 10,  8,  8,  8,  8,  8,  8, 10,  8, 10,  8,  8, 10, 10, 10,  8,  8,  8, 10, 10,  8,  8, 10, 10, 10,  8,  8,  8, 10, 10,  8,
  ],
  "button" : [
    11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    10, 11, 11, 11, 11, 11, 11, 11, 11, 11,  1,
    11,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
  ],
  "?" : [
    -1, -1,  0,  0,  0, -1, -1,
    -1,  0, -1, -1, -1,  0, -1,
    -1, -1, -1, -1, -1,  0, -1,
    -1, -1, -1,  0,  0, -1, -1,
    -1, -1, -1,  0, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1,  0, -1, -1, -1,
  ],
  "_" : [
    -1, -1, -1,  0, -1, -1, -1,
    -1, -1, -1,  0, -1, -1, -1,
    -1, -1, -1,  0, -1, -1, -1,
    -1,  0, -1,  0, -1,  0, -1,
    -1, -1,  0,  0,  0, -1, -1,
    -1, -1, -1,  0, -1, -1, -1,
    -1,  0,  0,  0,  0,  0, -1,
  ],
  "◻" : [
     0,  0,  0,  0,  0,  0,  0,
     0, -1, -1, -1, -1, -1,  0,
     0, -1, -1, -1, -1, -1,  0,
     0, -1, -1, -1, -1, -1,  0,
     0, -1, -1, -1, -1, -1,  0,
     0, -1, -1, -1, -1, -1,  0,
     0,  0,  0,  0,  0,  0,  0,
  ],
  "X" : [
     0, -1, -1, -1, -1, -1,  0,
    -1,  0, -1, -1, -1,  0, -1,
    -1, -1,  0, -1,  0, -1, -1,
    -1, -1, -1,  0, -1, -1, -1,
    -1, -1,  0, -1,  0, -1, -1,
    -1,  0, -1, -1, -1,  0, -1,
     0, -1, -1, -1, -1, -1,  0,
  ],
  "seeMore" : [
    10, 10, 10, 10, 10, 10, 10,
    10, 10,  0, 10,  0, 10, 10,
    10,  0, 10, 10, 10,  0, 10,
    10, 10,  0, 10,  0, 10, 10,
    10, 10, 10, 10, 10, 10, 10,
  ],
  "void" : [
    -1, -1, 11, -1, -1,
    -1, -1, 11, -1, -1,
    11, 11, 11, 11, 11,
    -1, -1, 11, -1, -1,
    -1, -1, 11, -1, -1,
  ],
  "mouseX" : [
    11, -1, 11, -1, -1, -1,
    11, -1, 11, -1, 11, 11,
    -1, 11, -1, -1, -1, -1,
    11, -1, 11, -1, 11, 11,
    11, -1, 11, -1, -1, -1,
  ],
  "mouseY" : [
    11, -1, 11, -1, -1, -1,
    11, -1, 11, -1, 11, 11,
    -1, 11, -1, -1, -1, -1,
    -1, 11, -1, -1, 11, 11,
    -1, 11, -1, -1, -1, -1,
 ],
  "dottedLine" : [
    1, -1, 1, -1, 1,
  ],
  "twoPoints" : [
    -1, 0, -1, 0, -1,
  ],
  "percentage" : [
     0,  0, -1, -1,  0,
     0, -1, -1,  0, -1,
    -1, -1,  0, -1, -1,
    -1,  0, -1, -1,  0,
     0, -1, -1,  0,  0,
  ],
  "transparent" : [
    11, 10, 11, 10, 11,
    10, 11, 10, 11, 10,
    11, 10, 11, 10, 11,
    10, 11, 10, 11, 10,
    11, 10, 11, 10, 11,
  ]
};

let layerIcons = [
  [
    -1, -1,  1, -1, -1,
    -1,  1,  1, -1, -1,
    -1, -1,  1, -1, -1,
    -1, -1,  1, -1, -1,
    -1, -1,  1, -1, -1,
    -1,  1,  1,  1, -1,
  ],
  [
    -1,  1,  1,  1, -1,
     1, -1, -1, -1,  1,
    -1, -1, -1, -1,  1,
    -1,  1,  1,  1, -1,
     1, -1, -1, -1, -1,
     1,  1,  1,  1,  1,
  ],
  [
     1,  1,  1,  1, -1,
    -1, -1, -1, -1,  1,
    -1, -1,  1,  1, -1,
    -1, -1, -1, -1,  1,
    -1, -1, -1, -1,  1,
     1,  1,  1,  1, -1,
  ],
  [
    -1, -1,  1, -1,  1,
    -1,  1, -1, -1,  1,
     1, -1, -1, -1,  1,
     1,  1,  1,  1,  1,
    -1, -1, -1, -1,  1,
    -1, -1, -1, -1,  1,
  ]
];

let canvas = document.querySelector("canvas");
canvas.width = 135; // minimum 135
canvas.height = 192; // minimum 70    original 192
let W = Math.max(135, canvas.width);
let H = Math.max(70, canvas.height);
let frameLength = W * H;
let mouse = {
  x : 0,
  y : 0,
  scroll : 1,
  leftClick : false,
  rightClick : false,
  justClicked : false,
  justReleased : false,
  lastButton: 0,
};
let ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

let clickedMouseX = 0;
let clickedMouseY = 0;
let shapeStarted = false;
let realMouseX = 0;
let realMouseY = 0;
let mouseX = 2;
let mouseY = 66;
let zoom = 1;
let zoomDelta = 0;
let zoomOriginX = 0;
let zoomOriginY = 0;
let imageX = W - 4;
let imageY = H - 68;
let currentLayer = 0;
let currentTool = 18;
let currentColor1 = 0;
let currentColor2 = 10;
let windowButtonsOrder = ["X", "◻", "_", "?"];
let currentToolPalette = [0, 14, 18, 3, 9, 10];
let toolList = Object.keys(toolIcons);
let seeMoreDelays = [0, 0, 0, 0, 0, 0];

canvas.addEventListener("wheel", e => {}); // TODO : zoom
canvas.addEventListener("contextmenu", e => e.preventDefault());
canvas.addEventListener("mousedown", e => {
  mouse.justClicked = true;
  if(e.button == 0) mouse.leftClick = true;
  else if(e.button == 2) mouse.rightClick = true;
});
window.addEventListener("mouseup", e => {
  mouse.justReleased = true;
  if(e.button == 0) { mouse.leftClick = false; mouse.lastButton = 0 }
  else if(e.button == 2) { mouse.rightClick = false; mouse.lastButton = 0 }
});
canvas.addEventListener("mousemove", e => {
  mouse.x = e.offsetX;
  mouse.y = e.offsetY;
});
canvas.addEventListener("scroll", e => {
  mouse.scroll = 0; // ??
});

let frame = new Uint8ClampedArray(frameLength * 4);
let pixelFrame = [];

function setPixelXY(x, y, color) {
  let i = x + y * W;
  pixelFrame[i] = color;
}

function getImageFromFrame(x, y, w, h) {
  let final = [];
  for(let i = 0; i < w; i++) {
    for(let j = 0; j < h; j++) {
      final[i + j * w] = getColorAt(x + i, y + j);
    }
  }
  return final;
}

function getColorAt(x, y) {
  if(x < 0 || x >= W || y < 0 || y >= H) return -2;
  let index = x + y * W;
  return (pixelFrame[index] == undefined)? -1 : pixelFrame[index];
}

function line(x0, y0, x1, y1, color) {
  var dx = Math.abs(x1 - x0);
  var dy = Math.abs(y1 - y0);
  var sx = (x0 < x1) ? 1 : -1;
  var sy = (y0 < y1) ? 1 : -1;
  var err = dx - dy;

  while(true) {
    setPixelXY(x0, y0, color);

    if ((x0 === x1) && (y0 === y1)) break;
    var e2 = 2*err;
    if (e2 > -dy) { err -= dy; x0  += sx; }
    if (e2 < dx) { err += dx; y0  += sy; }
  }
}

function hLine(x, y, w, color) {
  if(w > 0) {
    for(let i = 0; i < w; i++) {
      setPixelXY(x + i, y, color);
    }
  }
  else if (w <= 0) {
    for(let i = 0; i < -w; i++) {
      setPixelXY(x - i, y, color);
    }
  }
}

function vLine(x, y, h, color) {
  if(h > 0) {
    for(let i = 0; i < h; i++) {
      setPixelXY(x, y + i, color);
    }
  }
  else if (h <= 0) {
    for(let i = 0; i < -h; i++) {
      setPixelXY(x, y - i, color);
    }
  }
}

function fillRect(x, y, w, h, color) {
  for(let i = 0; i < w; i++) {
    vLine(x + i, y, h, color);
  }
}

function lineRect(x, y, w, h, color) {
  let maxX = x + w - 1;
  let maxY = y + h - 1;
  if(w > 0) {
    for(let i = 1; i < w - 1; i++) {
      setPixelXY(x + i, y,    color);
      setPixelXY(x + i, maxY, color);
    }
  }
  else if (w <= 0) {
    for(let i = 1; i < -w + 1; i++) {
      setPixelXY(x - i, y,    color);
      setPixelXY(x - i, maxY, color);
    }
  }
  if(h > 0) {
    for(let i = 0; i < h; i++) {
      setPixelXY(x,    y + i, color);
      setPixelXY(maxX, y + i, color);
    }
  }
  else if (h <= 0) {
    for(let i = 0; i < -h + 2; i++) {
      setPixelXY(x,    y - i, color);
      setPixelXY(maxX, y - i, color);
    }
  }
}

function numberlength(n, bold) {
  let string = "" + Math.floor(n);
  let final = string.length * 4;
  if(!bold) {
    for(let i = 0; i < string.length; i++) {
      if(+string[i] == 1) final--;
    }
  }
  return final;
}

function number(x, y, n, bold) {
  let string = "" + Math.floor(n);
  let currentX = x;
  for(let i = 0; i < string.length; i++) {
    let digitIndex = +string[i];
    drawImage(currentX, y, (bold)? bigNumbers[digitIndex] : littleNumbers[digitIndex], 3);
    currentX += (!bold && digitIndex == 1)? 3 : 4;
  }
  return currentX;
}

function drawImage(X, Y, imageArray, w) {
  let h = Math.floor(imageArray.length / w);
  for(let x = 0; x < w; x++) {
    for(let y = 0; y < h; y++) {
      let color = imageArray[x + y * w];
      if(color > -1) setPixelXY(X + x, Y + y, color);
    }
  }
}

function drawPattern(X, Y, imageArray, w, color) {
  let h = Math.floor(imageArray.length / w);
  for(let x = 0; x < w; x++) {
    if(X + x < 2) continue;
    if(X + x >= W - 2) break;
    for(let y = 0; y < h; y++) {
      if(Y + y < 66) continue;
      if(Y + y >= H - 2) break;
      if(imageArray[x + y * w] == 1) setPixelXY(X + x, Y + y, color);
    }
  }
}

function squareGradient(x, y, power, color1, color2) {
  for(let i = x - 1; i <= x + 1; i++) {
    for(let j = y - 1; j <= y + 1; j++) {
      if(!isPixelInCanvas(i, j)) continue;
      if(i % (Math.pow(2, power)) + j % (Math.pow(2, power)) == 0) setPixelXY(i, j, color1);
      else setPixelXY(i, j, color2);
    }
  }
}

function diamondGradient(x, y, power, color1, color2) {
  for(let i = x - 1; i <= x + 1; i++) {
    for(let j = y - 1; j <= y + 1; j++) {
      if(!isPixelInCanvas(i, j)) continue;
      if((i + j) % Math.pow(2, power) + j % Math.pow(2, power - 1) == 0) setPixelXY(i, j, color1);
      else setPixelXY(i, j, color2);
    }
  }
}

function shade(x, y, range, f) {
  let r = range;
  // let r = range / 2;
  for(let i = x - r; i <= x + r; i++) {
    for(let j = y - r; j <= y + r; j++) {
      if(!isPixelInCanvas(i, j)) continue;
      let X = Math.floor(i);
      let Y = Math.floor(j);
      let color = f(X, Y);
      if(color == -2) continue;
      setPixelXY(X, Y, color);
    }
  }
}

function doCoolStuff(formula) {
  for(let x = 0; x < W; x++) {
    for(let y = 0; y < H; y++) {
      setPixelXY(x, y, Math.floor(formula(x, y) % 20), 255);
    }
  }
}

function fillArea4(x, y, color) {
  let replaceColor = getColorAt(x, y);
  if(color == replaceColor) return;
  setPixelXY(x, y, color);
  if(getColorAt(x + 1, y) == replaceColor) fillArea4(x + 1, y, color);
  if(getColorAt(x - 1, y) == replaceColor) fillArea4(x - 1, y, color);
  if(getColorAt(x, y + 1) == replaceColor) fillArea4(x, y + 1, color);
  if(getColorAt(x, y - 1) == replaceColor) fillArea4(x, y - 1, color);
  return;
}

function fillArea8(x, y, color) {
  let replaceColor = getColorAt(x, y);
  if(color == replaceColor) return;
  setPixelXY(x, y, color);
  if(getColorAt(x + 1, y) == replaceColor)     fillArea8(x + 1, y, color);
  if(getColorAt(x - 1, y) == replaceColor)     fillArea8(x - 1, y, color);
  if(getColorAt(x, y + 1) == replaceColor)     fillArea8(x, y + 1, color);
  if(getColorAt(x, y - 1) == replaceColor)     fillArea8(x, y - 1, color);
  if(getColorAt(x + 1, y + 1) == replaceColor) fillArea8(x + 1, y + 1, color);
  if(getColorAt(x - 1, y + 1) == replaceColor) fillArea8(x - 1, y + 1, color);
  if(getColorAt(x + 1, y - 1) == replaceColor) fillArea8(x + 1, y - 1, color);
  if(getColorAt(x - 1, y - 1) == replaceColor) fillArea8(x - 1, y - 1, color);
  return;
}

function ellipse(x1, y1, x2, y2, color) {
  let rx = Math.floor((x2 - x1) / 2);
  let ry = Math.floor((y2 - y1) / 2);
  let xc = x1 + rx;
  let yc = y1 + ry;

  if(ry >= 0) {
    let x = 0;
    let y = ry;
    let p = ry*ry-rx*rx*ry+(rx*rx)/4;
    while((2*x*ry*ry)<(2*y*rx*rx)) {
      setPixelXY(xc+x, yc-y, color);
      setPixelXY(xc-x, yc+y, color);
      setPixelXY(xc+x, yc+y, color);
      setPixelXY(xc-x, yc-y, color);
  
      x++;
      if(p<0) {
        p = p+(2*ry*ry*x)+(ry*ry);
      }
      else {
        y = y-1;
        p = p+(2*ry*ry*x+ry*ry)-(2*rx*rx*y);
      }
    }
    p = (x+0.5)*(x+0.5)*ry*ry+(y-1)*(y-1)*rx*rx-rx*rx*ry*ry;
    while(y>=0) {
      setPixelXY(xc+x, yc-y, color);
      setPixelXY(xc-x, yc+y, color);
      setPixelXY(xc+x, yc+y, color);
      setPixelXY(xc-x, yc-y, color);
  
      y--;
      if(p>0) {
        p = p-(2*rx*rx*y)+(rx*rx);
      }
      else {
       x = x+1;
       p = p+(2*ry*ry*x)-(2*rx*rx*y)-(rx*rx);
      }
    }
  }
  else {
    let x = 0;
    let y = -ry;
    let p = ry*ry+rx*rx*ry+(rx*rx)/4;
    while((2*x*ry*ry)<(2*y*rx*rx)) {
      setPixelXY(xc+x, yc-y, color);
      setPixelXY(xc-x, yc+y, color);
      setPixelXY(xc+x, yc+y, color);
      setPixelXY(xc-x, yc-y, color);
  
      x++;
      if(p<0) {
        p = p+(2*ry*ry*x)+(ry*ry);
      }
      else {
        y = y-1;
        p = p+(2*ry*ry*x+ry*ry)-(2*rx*rx*y);
      }
    }
    p = (x+0.5)*(x+0.5)*ry*ry+(y-1)*(y-1)*rx*rx-rx*rx*ry*ry;
    while(y>=0) {
      setPixelXY(xc+x, yc-y, color);
      setPixelXY(xc-x, yc+y, color);
      setPixelXY(xc+x, yc+y, color);
      setPixelXY(xc-x, yc-y, color);
  
      y--;
      if(p>0) {
        p = p-(2*rx*rx*y)+(rx*rx);
      }
      else {
       x = x+1;
       p = p+(2*ry*ry*x)-(2*rx*rx*y)-(rx*rx);
      }
    }
  }

}

function isPixelInCanvas(x, y) {
  return 1 < x && x < W - 2 && 65 < y && y < H - 2;
}

function draw(dt) {

  // inputs

  realMouseX = Math.floor(W / canvas.offsetWidth * mouse.x);
  realMouseY = Math.floor(H / canvas.offsetHeight * mouse.y);
  let isMouseInCanvas = isPixelInCanvas(realMouseX, realMouseY);
  let oldMouseX = mouseX;
  let oldMouseY = mouseY;
  if(isMouseInCanvas) {
    mouseX = realMouseX;
    mouseY = realMouseY;
  }
  if(mouse.justClicked) {
    clickedMouseX = mouseX;
    clickedMouseY = mouseY;
  }

  // UI

  for(let i = 0; i < 4; i++) {
    let x = W - 11;
    let y = 18 + i * 9;
    if(mouse.leftClick && x <= realMouseX && realMouseX < x + 9 && y <= realMouseY && realMouseY < y + 10) currentLayer = i;
  }
  
  lineRect(0, 0, W, H, 11);
  lineRect(1, 1, W - 2, H - 2, 1);
  fillRect(2, 2, W - 4, 64, 10);

  lineRect(2, 2, W - 4, 13, 8);
  drawImage(4, 4, windowIcons.title, 77);
  lineRect(3, 3, 79, 11, 8);
  fillRect(82, 3, W - 133, 11, 8);
  for(let i = 0; i < 4; i++) {
    let x = W - i * 12 - 14;
    if(mouse.leftClick && x <= realMouseX && realMouseX < x + 11 && 3 <= realMouseY && realMouseY < 14) fillRect(x, 3, 11, 11, 1);
    else drawImage(x, 3, windowIcons.button, 11);
    drawImage(x + 2, 5, windowIcons[windowButtonsOrder[i]], 7);
    vLine(x - 1, 3, 11, 8);
  }
  hLine(2, 15, W - 4, 1);

  hLine(2, 16, W - 4, 11);
  for(let i = 0; i < 6; i++) {
    let x = 3 + i * 20;
    let hasHitSeeMore = (x + 11 <= realMouseX && realMouseX < x + 19 && 30 <= realMouseY && realMouseY < 36);
    lineRect(x, 17, 19, 19, 1);
    if(mouse.leftClick && x <= realMouseX && realMouseX < x + 19 && 17 <= realMouseY && realMouseY < 36 && !hasHitSeeMore) currentTool = currentToolPalette[i];
    else if(mouse.leftClick && (x + 15 <= realMouseX && realMouseX < x + 19 && 30 <= realMouseY && realMouseY < 36) && seeMoreDelays[i] == 0) { currentTool = currentToolPalette[i] = (currentToolPalette[i] + 1 < toolList.length)? currentToolPalette[i] + 1 : 0; seeMoreDelays[i] = 10}
    else if(mouse.leftClick && (x + 11 <= realMouseX && realMouseX < x + 15 && 30 <= realMouseY && realMouseY < 36) && seeMoreDelays[i] == 0) { currentTool = currentToolPalette[i] = (currentToolPalette[i] > 0)? currentToolPalette[i] - 1 : toolList.length - 1; seeMoreDelays[i] = 10}
    seeMoreDelays[i] = (seeMoreDelays[i] - 1 < 0)? 0 : seeMoreDelays[i] - 1;
    if(currentTool == currentToolPalette[i]) fillRect(x + 1, 18, 17, 17, 5);
    drawImage(x + 2, 19, toolIcons[toolList[currentToolPalette[i]]], 15);
    drawImage(x + 11, 30, windowIcons.seeMore, 7);
    vLine(x - 1, 17, 19, 11);
  }
  for(let j = 0; j < 2; j++) {
    for(let i = 0; i < 12; i++) {
      let index = j * 12 + i;
      let x = 3 + i * 10;
      let y = 37 + j * 10;
      if(colors[index * 3] != undefined) {
        fillRect(x + 2, y + 2, 5, 5, index);
        if(mouse.leftClick && x <= realMouseX && realMouseX < x + 9 && y <= realMouseY && realMouseY < y + 9) currentColor1 = index;
        if(mouse.rightClick && x <= realMouseX && realMouseX < x + 9 && y <= realMouseY && realMouseY < y + 9) currentColor2 = index;
        lineRect(x, y, 9, 9, (currentColor1 == index)? 3 : (currentColor2 == index)? 7 : 1);
        if(currentColor1 == index) hLine(x + 1, y + 4, 7, 3);
        if(currentColor2 == index) vLine(x + 4, y + 1, 7, 7);
      }
      else {
        drawImage(x + 2, y + 2, windowIcons.transparent, 5);
        if(mouse.leftClick && x <= realMouseX && realMouseX < x + 9 && y <= realMouseY && realMouseY < y + 9) currentColor1 = -1;
        if(mouse.rightClick && x <= realMouseX && realMouseX < x + 9 && y <= realMouseY && realMouseY < y + 9) currentColor2 = -1;
        lineRect(x, y, 9, 9, (currentColor1 == -1)? 3 : (currentColor2 == -1)? 7 : 1);
        if(currentColor1 == -1) hLine(x + 1, y + 4, 7, 3);
        if(currentColor2 == -1) vLine(x + 4, y + 1, 7, 7);
      }
      vLine(x - 1, y, 9, 11);
    }
  }
  hLine(2, 36, 120, 11);
  hLine(2, 46, 120, 11);
  fillRect(122, 17, W - 135, 39, 11);
  hLine(2, 56, W - 4, 11);

  lineRect(W - 12, 18, 9, 37, 1);
  for(let i = 0; i < 4; i++) {
    let x = W - 11;
    let y = 18 + i * 9;
    hLine(x, y, 7, 1);
    if(i == currentLayer) fillRect(x, y + 1, 7, 8, 11);
    drawImage(x + 1, y + 2, layerIcons[i], 5);
  }
  lineRect(W - 13, 17, 11, 39, 11);
  hLine(2, 57, W - 4, 1);

  drawImage(3, 59, windowIcons.mouseX, 6);
  let a = number(10, 59, mouseX - 2, false);
  drawImage(a, 59, windowIcons.dottedLine, 1);
  drawImage(a + 2, 59, windowIcons.mouseY, 6);
  let b = number(a + 9, 59, mouseY - 66, false);
  vLine(b, 58, 7, 1);

  drawImage(W - 9, 59, windowIcons.percentage, 5);
  let c = W - numberlength(zoom * 100) - 11;
  number(c + 2, 59, zoom * 100, false);
  vLine(c, 58, 7, 1);

  let d = Math.floor((b + c) / 2) - numberlength(imageX);
  let e = number(d, 59, imageX, false);
  drawImage(e, 59, windowIcons.twoPoints, 1);
  number(e + 2, 59, imageY, false);

  hLine(2, 65, W - 4, 1);

  // tools
  let tool = toolList[currentTool];

  // pencil
  if     (tool == "pencil" && isMouseInCanvas && mouse.rightClick) line(oldMouseX, oldMouseY, mouseX, mouseY, currentColor2);
  else if(tool == "pencil" && isMouseInCanvas && mouse.leftClick)  line(oldMouseX, oldMouseY, mouseX, mouseY, currentColor1);
  // bucket
  else if(tool == "bucket" && isMouseInCanvas && mouse.rightClick) fillArea4(mouseX, mouseY, currentColor2);
  else if(tool == "bucket" && isMouseInCanvas && mouse.leftClick)  fillArea4(mouseX, mouseY, currentColor1);
  // bucketPlus
  else if(tool == "bucketPlus" && isMouseInCanvas && mouse.rightClick) fillArea8(mouseX, mouseY, currentColor2);
  else if(tool == "bucketPlus" && isMouseInCanvas && mouse.leftClick)  fillArea8(mouseX, mouseY, currentColor1);
  // rubber
  else if(tool == "rubber" && isMouseInCanvas && mouse.rightClick) line(oldMouseX, oldMouseY, mouseX, mouseY, -1);
  else if(tool == "rubber" && isMouseInCanvas && mouse.leftClick)  line(oldMouseX, oldMouseY, mouseX, mouseY, -1);
  // colorPicker
  else if(tool == "colorPicker" && isMouseInCanvas && mouse.rightClick) currentColor2 = getColorAt(mouseX, mouseY);
  else if(tool == "colorPicker" && isMouseInCanvas && mouse.leftClick)  currentColor1 = getColorAt(mouseX, mouseY);
  // brush0
  else if(tool == "brush0" && isMouseInCanvas && mouse.rightClick) drawPattern(mouseX, mouseY, patterns.brush0, 1, currentColor2);
  else if(tool == "brush0" && isMouseInCanvas && mouse.leftClick)  drawPattern(mouseX, mouseY, patterns.brush0, 1, currentColor1);
  // brush1
  else if(tool == "brush1" && isMouseInCanvas && mouse.rightClick) drawPattern(mouseX - 1, mouseY - 1, patterns.brush1, 3, currentColor2);
  else if(tool == "brush1" && isMouseInCanvas && mouse.leftClick)  drawPattern(mouseX - 1, mouseY - 1, patterns.brush1, 3, currentColor1);
  // brush2
  else if(tool == "brush2" && isMouseInCanvas && mouse.rightClick) drawPattern(mouseX - 2, mouseY - 2, patterns.brush2, 5, currentColor2);
  else if(tool == "brush2" && isMouseInCanvas && mouse.leftClick)  drawPattern(mouseX - 2, mouseY - 2, patterns.brush2, 5, currentColor1);
  // brush3
  else if(tool == "brush3" && isMouseInCanvas && mouse.rightClick) drawPattern(mouseX - 3, mouseY - 3, patterns.brush3, 7, currentColor2);
  else if(tool == "brush3" && isMouseInCanvas && mouse.leftClick)  drawPattern(mouseX - 3, mouseY - 3, patterns.brush3, 7, currentColor1);
  // brush4
  else if(tool == "brush4" && isMouseInCanvas && mouse.rightClick) drawPattern(mouseX - 6, mouseY - 6, patterns.brush4, 13, currentColor2);
  else if(tool == "brush4" && isMouseInCanvas && mouse.leftClick)  drawPattern(mouseX - 6, mouseY - 6, patterns.brush4, 13, currentColor1);
  // brush5
  else if(tool == "brush5" && isMouseInCanvas && mouse.rightClick) drawPattern(mouseX - 7, mouseY - 7, patterns.brush5, 15, currentColor2);
  else if(tool == "brush5" && isMouseInCanvas && mouse.leftClick)  drawPattern(mouseX - 7, mouseY - 7, patterns.brush5, 15, currentColor1);
  // line
  else if(tool == "line" && isMouseInCanvas && mouse.rightClick && mouse.justClicked)  shapeStarted = 2;
  else if(tool == "line" && isMouseInCanvas && mouse.leftClick  && mouse.justClicked)  shapeStarted = 1;
  else if(tool == "line" && isMouseInCanvas && mouse.justReleased) {line(clickedMouseX, clickedMouseY, mouseX, mouseY, (shapeStarted == 1)? currentColor1 : currentColor2); shapeStarted = false;}
  // rectangle
  else if(tool == "rectangle" && isMouseInCanvas && mouse.rightClick && mouse.justClicked)  shapeStarted = 2;
  else if(tool == "rectangle" && isMouseInCanvas && mouse.leftClick  && mouse.justClicked)  shapeStarted = 1;
  else if(tool == "rectangle" && isMouseInCanvas && mouse.justReleased) {lineRect(clickedMouseX, clickedMouseY, mouseX - clickedMouseX + 1, mouseY - clickedMouseY + 1, (shapeStarted == 1)? currentColor1 : currentColor2); shapeStarted = false;}
  // ellipse
  else if(tool == "ellipse" && isMouseInCanvas && mouse.rightClick && mouse.justClicked)  shapeStarted = 2;
  else if(tool == "ellipse" && isMouseInCanvas && mouse.leftClick  && mouse.justClicked)  shapeStarted = 1;
  else if(tool == "ellipse" && isMouseInCanvas && mouse.justReleased) {ellipse(clickedMouseX, clickedMouseY, mouseX, mouseY, (shapeStarted == 1)? currentColor1 : currentColor2); shapeStarted = false;}
  // gradient 0
  else if(tool == "gradient0" && isMouseInCanvas && mouse.rightClick) shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + (y + 1)) % 2 == 0)? currentColor2 : currentColor1);
  else if(tool == "gradient0" && isMouseInCanvas && mouse.leftClick)  shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + y) % 2 == 0)? currentColor1 : currentColor2);
  // gradient 1
  else if(tool == "gradient1" && isMouseInCanvas && mouse.rightClick) shade(mouseX, mouseY, currentLayer + 1, (x, y) => (x % 2 + (y + 1) % 2 == 0)? currentColor2 : currentColor1);
  else if(tool == "gradient1" && isMouseInCanvas && mouse.leftClick)  shade(mouseX, mouseY, currentLayer + 1, (x, y) => (x % 2 + y % 2 == 0)? currentColor1 : currentColor2);
  // gradient 2
  else if(tool == "gradient2" && isMouseInCanvas && mouse.rightClick) shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + (y + 1)) % 4 + (y + 1) % 2 == 0)? currentColor2 : currentColor1);
  else if(tool == "gradient2" && isMouseInCanvas && mouse.leftClick)  shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + y) % 4 + y % 2 == 0)? currentColor1 : currentColor2);
  // gradient 3
  else if(tool == "gradient3" && isMouseInCanvas && mouse.rightClick) shade(mouseX, mouseY, currentLayer + 1, (x, y) => (x % 4 + (y + 1) % 4 == 0)? currentColor2 : currentColor1);
  else if(tool == "gradient3" && isMouseInCanvas && mouse.leftClick)  shade(mouseX, mouseY, currentLayer + 1, (x, y) => (x % 4 + y % 4 == 0)? currentColor1 : currentColor2);
  // gradient 4
  else if(tool == "gradient4" && isMouseInCanvas && mouse.rightClick) shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + (y + 1)) % 8 + (y + 1) % 4 == 0)? currentColor2 : currentColor1);
  else if(tool == "gradient4" && isMouseInCanvas && mouse.leftClick)  shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + y) % 8 + y % 4 == 0)? currentColor1 : currentColor2);

  let currentDrawing = getImageFromFrame(2, 66, W - 4, H - 4);

  // what happens here won't be saved onto the canvas + it will be on the foreground, we can do previews

  // brushes
  if     (tool == "brush0" && isMouseInCanvas) drawPattern(mouseX    , mouseY    , patterns.brush0, 1 , (mouse.lastButton == 2)? currentColor2 : currentColor1);
  else if(tool == "brush1" && isMouseInCanvas) drawPattern(mouseX - 1, mouseY - 1, patterns.brush1, 3 , (mouse.lastButton == 2)? currentColor2 : currentColor1);
  else if(tool == "brush2" && isMouseInCanvas) drawPattern(mouseX - 2, mouseY - 2, patterns.brush2, 5 , (mouse.lastButton == 2)? currentColor2 : currentColor1);
  else if(tool == "brush3" && isMouseInCanvas) drawPattern(mouseX - 3, mouseY - 3, patterns.brush3, 7 , (mouse.lastButton == 2)? currentColor2 : currentColor1);
  else if(tool == "brush4" && isMouseInCanvas) drawPattern(mouseX - 6, mouseY - 6, patterns.brush4, 13, (mouse.lastButton == 2)? currentColor2 : currentColor1);
  else if(tool == "brush5" && isMouseInCanvas) drawPattern(mouseX - 7, mouseY - 7, patterns.brush5, 15, (mouse.lastButton == 2)? currentColor2 : currentColor1);
  // shapes
  else if(tool == "line" && shapeStarted && mouse.rightClick) line(clickedMouseX, clickedMouseY, mouseX, mouseY, currentColor2);
  else if(tool == "line" && shapeStarted && mouse.leftClick)  line(clickedMouseX, clickedMouseY, mouseX, mouseY, currentColor1);
  else if(tool == "rectangle" && mouse.rightClick) lineRect(clickedMouseX, clickedMouseY, mouseX - clickedMouseX + 1, mouseY - clickedMouseY + 1, (shapeStarted == 1)? currentColor1 : currentColor2);
  else if(tool == "rectangle" && mouse.leftClick)  lineRect(clickedMouseX, clickedMouseY, mouseX - clickedMouseX + 1, mouseY - clickedMouseY + 1, (shapeStarted == 1)? currentColor1 : currentColor2);
  else if(tool == "ellipse" && shapeStarted && mouse.rightClick) ellipse(clickedMouseX, clickedMouseY, mouseX, mouseY, currentColor2);
  else if(tool == "ellipse" && shapeStarted && mouse.leftClick)  ellipse(clickedMouseX, clickedMouseY, mouseX, mouseY, currentColor1);
  // gradients
  else if(tool == "gradient0" && isMouseInCanvas) shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + y) % 2 == 0)?           currentColor1 : currentColor2);
  else if(tool == "gradient1" && isMouseInCanvas) shade(mouseX, mouseY, currentLayer + 1, (x, y) => (x % 2 + y % 2 == 0)?         currentColor1 : currentColor2);
  else if(tool == "gradient2" && isMouseInCanvas) shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + y) % 4 + y % 2 == 0)?   currentColor1 : currentColor2);
  else if(tool == "gradient3" && isMouseInCanvas) shade(mouseX, mouseY, currentLayer + 1, (x, y) => (x % 4 + y % 4 == 0)?         currentColor1 : currentColor2);
  else if(tool == "gradient4" && isMouseInCanvas) shade(mouseX, mouseY, currentLayer + 1, (x, y) => ((x + y) % 8 + y % 4 == 0)?   currentColor1 : currentColor2);

  for(let i = 0; i < pixelFrame.length; i++) {
    let index = i * 4;
    if(pixelFrame[i] >= 0 && pixelFrame[i] < colors.length) {
      let color = pixelFrame[i] * 3;
      frame[index]     = colors[color];
      frame[index + 1] = colors[color + 1];
      frame[index + 2] = colors[color + 2];
      frame[index + 3] = 255;
    }
    else {
      frame[index]     = 0;
      frame[index + 1] = 0;
      frame[index + 2] = 0;
      frame[index + 3] = 0;
    }
  }

  ctx.putImageData(new ImageData(frame, W, H), 0, 0);
  mouse.justReleased = false;
  mouse.justClicked = false;
  pixelFrame = [];
  drawImage(2, 66, currentDrawing, W - 4);

  requestAnimationFrame(draw);
}

requestAnimationFrame(draw);